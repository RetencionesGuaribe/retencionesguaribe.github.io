<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Generador de Actas de Entrega</title>
    <style>
    /* Estilos Generales */
    body {
        margin: 0;
        padding: 20px;
        font-family: 'Arial', sans-serif;
        background: #f5f5f5;
    }

    /* Contenedor A4 optimizado */
    .container-a4 {
        width: 210mm;
        height: 297mm;
        margin: 0 auto;
        padding: 15mm 20mm;
        background: white;
        box-shadow: 0 0 10px rgba(0,0,0,0.1);
        position: relative;
    }

    /* Encabezado - Posicionamiento Absoluto */
    .header {
        position: relative;
        height: 50px;
        margin-bottom: 20px;
        padding: 5px 0;
        border-bottom: 2px solid #000;
    }

    .header-logo {
        position: absolute;
        height: 45px;
        width: auto;
        top: 2px;
        z-index: 1;
    }

    .header-logo:first-child {
        left: 15px;
    }

    .header-logo:last-child {
        right: 15px;
    }

    .header-center {
        position: absolute;
        left: 50%;
        transform: translateX(-50%);
        width: 75%;
        text-align: center;
        top: 3px;
        font-size: 10pt;
        line-height: 1.1;
        z-index: 2;
    }

    .header h2 {
        font-size: 13px;
        margin: 2px 0;
        letter-spacing: 0.5px;
    }

    .header h3, .header p {
        font-size: 11px;
        margin: 1px 0;
        letter-spacing: 0.3px;
    }

    /* Contenido Principal */
    .content-container {
        font-size: 11pt;
        line-height: 1.4;
        margin-top: 10px;
    }

    /* Elementos del Formulario */
    input, select, textarea {
        width: 100%;
        padding: 1mm;
        margin: 1mm 0 3mm 0;
        border: 1px solid #ddd;
        font-size: 11pt;
        box-sizing: border-box;
    }

    /* Tabla de Productos */
    .tabla-productos {
        width: 100%;
        border-collapse: collapse;
        margin: 3mm 0;
    }

    .tabla-productos th:nth-child(1) {
        width: 15%;
    }

    .tabla-productos td, .tabla-productos th {
        border: 1px solid #ddd;
        padding: 2mm;
        font-size: 10pt;
        height: 6mm;
    }

    /* Sección de Firmas */
    .firmas-section {
        display: flex;
        justify-content: space-between;
        margin-top: 20mm;
        padding-top: 8mm;
        border-top: 1px solid #000;
    }

    /* Botones */
    .botones-edicion {
        text-align: center;
        margin-top: 15px;
    }

    .boton-editar {
        background-color: #4CAF50;
        color: white;
        padding: 8px 20px;
        border: none;
        cursor: pointer;
        margin: 0 5px;
    }

    /* Estilos para Impresión */
    @media print {
        body {
            background: none;
            margin: 0 !important;
            padding: 0 !important;
        }
        .container-a4 {
            box-shadow: none;
            page-break-inside: avoid;
            height: auto;
            min-height: 297mm;
            padding: 10mm 15mm;
        }
        .no-print {
            display: none !important;
        }
        .header {
            height: 45px;
            margin-bottom: 15px;
        }
        .header-logo {
            height: 40px;
        }
        .header-center {
            width: 80%;
            font-size: 9.5pt;
        }
        .content-container {
            font-size: 10pt;
        }
    }
</style>
</head>
<body>
    <div class="container-a4">
        <!-- Encabezado -->
        <div class="header">
            <img src="images/logo.png" alt="Escudo" class="header-logo">
            <div class="header-center">
                <h2>REPÚBLICA BOLIVARIANA DE VENEZUELA</h2>
                <h3>ALCALDÍA BOLIVARIANA DEL MUNICIPIO SAN JOSÉ DE GUARIBE</h3>
                <h3>ESTADO GUÁRICO - DIRECCIÓN DE ADMINISTRACIÓN Y FINANZAS</h3>
                <p>RIF: G-20000382-0</p>
            </div>
            <img src="images/logo1.png" alt="Bandera" class="header-logo">
        </div>

        <!-- Contenido -->
        <div class="content-container">
		<div id="editar-index" style="display:none;"></div>
            <!-- Formulario -->
            <div id="formulario" style="display: block;">
                <select id="tipo-funcionario">
                    <option value="adscrito">Adscrito</option>
                    <option value="no-adscrito">No Adscrito</option>
                </select>

                <input type="text" id="numero-acta" placeholder="N° de Acta" required>
                <input type="date" id="fecha" required>
                <input type="text" id="nombre" placeholder="Nombre completo" required>
                <input type="text" id="cedula" placeholder="Cédula" required>

                <div id="campos-adscrito">
                    <input type="text" id="direccion" placeholder="Dirección/Dependencia">
                    <input type="text" id="cargo" placeholder="Cargo">
                </div>

                <div style="display:flex;gap:3mm;margin:3mm 0">
				<input type="number" id="cantidad" placeholder="Cantidad" style="width:15%">
				<input type="text" id="descripcion" placeholder="Descripción" style="flex-grow:1">
				<button onclick="agregarProducto()">➕</button>
				<button onclick="cancelarEdicion()" id="cancelar-btn" style="display:none;">❌ Cancelar</button>
				</div>

                <table class="tabla-productos">
                    <thead>
                        <tr><th>Cantidad</th><th>Descripción</th><th>Acción</th></tr>
                    </thead>
                    <tbody id="productos-body">
                        <tr class="placeholder-row"><td colspan="3">No hay productos agregados</td></tr>
                    </tbody>
                </table>

                <textarea id="uso-previsto" rows="3" placeholder="Los cuales serán utilizados:"></textarea>
                <button onclick="generarActa()">Generar Acta</button>
            </div>

            <!-- Acta Generada -->
            <div id="acta-generada" style="display: none;"></div>
        </div>
    </div>

    <script>
        let productos = [];
        let datosGuardados = {};

        function toggleAdscrito() {
            document.getElementById('campos-adscrito').style.display = 
                document.getElementById('tipo-funcionario').value === 'adscrito' ? 'block' : 'none';
        }

        function agregarProducto() {
    const cantidad = document.getElementById('cantidad').value;
    const descripcion = document.getElementById('descripcion').value.trim();
    const editarIndex = document.getElementById('editar-index').dataset.index;

    if(cantidad && descripcion) {
        if(editarIndex !== undefined) {
            productos[editarIndex] = { cantidad, descripcion };
            delete document.getElementById('editar-index').dataset.index;
            document.querySelector('[onclick="agregarProducto()"]').textContent = "➕";
        } else {
            productos.push({cantidad, descripcion});
        }
        actualizarTabla();
        document.getElementById('cantidad').value = '';
        document.getElementById('descripcion').value = '';
        document.querySelector('[onclick="agregarProducto()"]').textContent = "➕";
    }

    // Ocultar botón de cancelar siempre que termine una acción
    document.getElementById('cancelar-btn').style.display = 'none';
}

        function actualizarTabla() {
    const tbody = document.querySelector('#productos-body');
    tbody.innerHTML = productos.length > 0 
        ? productos.map((p, i) => `
            <tr>
                <td>${p.cantidad}</td>
                <td>${p.descripcion}</td>
                <td>
                    <button onclick="editar(${i})">✏️</button>
                    <button onclick="eliminar(${i})">❌</button>
                </td>
            </tr>`).join('')
        : '<tr class="placeholder-row"><td colspan="3">No hay productos agregados</td></tr>';
}
function editar(index) {
    const producto = productos[index];
    document.getElementById('cantidad').value = producto.cantidad;
    document.getElementById('descripcion').value = producto.descripcion;
    document.getElementById('editar-index').dataset.index = index;
    // Cambiar texto del botón
    document.querySelector('[onclick="agregarProducto()"]').textContent = "Actualizar";
    // Mostrar botón de cancelar
    document.getElementById('cancelar-btn').style.display = 'inline-block';
}

        function eliminar(index) {
            productos.splice(index, 1);
            actualizarTabla();
        }

        function generarActa() {
            // Guardar datos
            datosGuardados = {
                tipo: document.getElementById('tipo-funcionario').value,
                numero: document.getElementById('numero-acta').value,
                fecha: document.getElementById('fecha').value,
                nombre: document.getElementById('nombre').value,
                cedula: document.getElementById('cedula').value,
                direccion: document.getElementById('direccion').value,
                cargo: document.getElementById('cargo').value,
                uso: document.getElementById('uso-previsto').value,
                productos: [...productos]
            };

            const fecha = document.getElementById('fecha').value;
            const año = fecha ? fecha.split('-')[0] : new Date().getFullYear();
            
            // Generar 15 filas
            let productosHTML = '';
            for(let i = 0; i < 15; i++) {
                if(productos[i]) {
                    productosHTML += `<tr><td>${productos[i].cantidad}</td><td>${productos[i].descripcion}</td></tr>`;
                } else {
                    productosHTML += `<tr><td style="color:#999">-</td><td style="color:#999">-</td></tr>`;
                }
            }

            const actaHTML = `
                <div style="page-break-inside: avoid;">
                    <p style="text-align: right; margin: 2mm 0; font-size: 10pt;">SAN JOSÉ DE GUARIBE, ${(() => {
  const [year, month, day] = fecha.split('-');
  const localDate = new Date(year, month - 1, day);
  return localDate.toLocaleDateString('es-VE');
})()}</p>
                    <h2 style="text-align: center; margin: 5mm 0; font-size: 12pt;">
                        ACTA DE ENTREGA N° ${document.getElementById('numero-acta').value} - ${año}
                    </h2>

                    <p style="margin-bottom: 5mm;">
                        Yo, ${document.getElementById('nombre').value}, C.I. ${document.getElementById('cedula').value}${datosGuardados.tipo === 'adscrito' ? `, adscrito(a) a ${document.getElementById('direccion').value} como ${document.getElementById('cargo').value},` : ','}
                        he recibido de la Jefatura de Compras de la Alcaldía Bolivariana del Municipio San José de Guaribe, Estado Guárico lo siguiente:
                    </p>

                    <table border="1" style="width:100%; margin:5mm 0; font-size: 10pt;">
                        <thead>
                            <tr><th style="width:15%">Cantidad</th><th>Descripción</th></tr>
                        </thead>
                        <tbody>${productosHTML}</tbody>
                    </table>

                    <p style="margin: 3mm 0;"><strong>Los cuales serán utilizados:</strong> ${document.getElementById('uso-previsto').value}</p>

                    <div class="firmas-section">
                        <div class="firma-box">
                            <table style="width:100%; font-size: 10pt;">
                                <tr><td colspan="2"><strong>ENTREGADO POR:</strong></td></tr>
                                <tr><td>Nombre:</td><td>_________________________</td></tr>
                                <tr><td>C.I:</td><td>_________________________</td></tr>
                                <tr><td>Firma:</td><td>_________________________</td></tr>
                            </table>
                        </div>

                        <div class="firma-box">
                            <table style="width:100%; font-size: 10pt;">
                                <tr><td colspan="2"><strong>RECIBIDO POR:</strong></td></tr>
                                <tr><td>Nombre:</td><td>${document.getElementById('nombre').value}</td></tr>
                                <tr><td>C.I:</td><td>${document.getElementById('cedula').value}</td></tr>
                                <tr><td>Firma:</td><td>_________________________</td></tr>
                            </table>
                        </div>
                    </div>

                    <div class="no-print botones-edicion">
                        <button class="boton-editar" onclick="habilitarEdicion()">Editar Acta</button>
                        <button class="boton-editar" onclick="window.print()">Imprimir</button>
                    </div>
                </div>
            `;

            document.getElementById('formulario').style.display = 'none';
            document.getElementById('acta-generada').innerHTML = actaHTML;
            document.getElementById('acta-generada').style.display = 'block';
        }

        function habilitarEdicion() {
            // Restaurar valores
            document.getElementById('tipo-funcionario').value = datosGuardados.tipo;
            document.getElementById('numero-acta').value = datosGuardados.numero;
            document.getElementById('fecha').value = datosGuardados.fecha;
            document.getElementById('nombre').value = datosGuardados.nombre;
            document.getElementById('cedula').value = datosGuardados.cedula;
            document.getElementById('direccion').value = datosGuardados.direccion;
            document.getElementById('cargo').value = datosGuardados.cargo;
            document.getElementById('uso-previsto').value = datosGuardados.uso;
            
            // Restaurar productos
            productos = [...datosGuardados.productos];
            actualizarTabla();
            
            // Mostrar formulario
            document.getElementById('formulario').style.display = 'block';
            document.getElementById('acta-generada').style.display = 'none';
        }

        // Inicializar
        toggleAdscrito();
        document.getElementById('tipo-funcionario').onchange = toggleAdscrito;
		
		function cancelarEdicion() {
    // Limpiar campos del formulario
    document.getElementById('cantidad').value = '';
    document.getElementById('descripcion').value = '';
    // Eliminar índice de edición
    delete document.getElementById('editar-index').dataset.index;
    // Restablecer texto del botón "Agregar"
    document.querySelector('[onclick="agregarProducto()"]').textContent = "➕";
    // Ocultar el botón de cancelar
    document.getElementById('cancelar-btn').style.display = 'none';
}
    </script>
	
	<script>
        (function() {
            const dominioPermitido = 'https://retencionesguaribe.github.io/entrega.html';
            const urlActual = window.location.href;
            const tiempoEspera = 2000; // Tiempo de espera en milisegundos (2 segundos)
            const urlRedireccion = 'https://github.com/enterprise/advanced-security#pricing'; // URL de redirección personalizable
            const mensajeTexto = 'Esta página solo puede ejecutarse en el dominio autorizado. Serás redirigido...';

            if (window.location.protocol === 'file:' || !urlActual.startsWith(dominioPermitido)) {
                // Crear un mensaje en la página
                const mensaje = document.createElement('div');
                mensaje.className = 'mensaje-redireccion';
                mensaje.setAttribute('role', 'alert');
                mensaje.setAttribute('aria-live', 'assertive');
                mensaje.textContent = mensajeTexto;
                document.body.appendChild(mensaje);

                // Deshabilitar la página
                document.body.classList.add('deshabilitado');

                // Redirigir después de un breve retraso
                setTimeout(function() {
                    try {
                        window.location.href = urlRedireccion;
                    } catch (error) {
                        console.error("Error al redirigir:", error);
                        mensaje.textContent = 'Ocurrió un error al redirigir. Por favor, inténtalo de nuevo más tarde.';
                    }
                }, tiempoEspera);
            }
        })();
    </script>

<script>
    (function() {
        // Configuración personalizable
        const tiempoEspera = 2000; // 2 segundos de espera
        const urlRedireccion = 'index.html'; // Página de login
        const mensajeTexto = 'Debe iniciar sesión para acceder a esta página. Serás redirigido...';
        
        // Verificar si existe un usuario autenticado
        const usuario = JSON.parse(sessionStorage.getItem('usuario'));
        if (!usuario?.nombre) {
            
            // Crear mensaje de alerta
            const mensaje = document.createElement('div');
            mensaje.className = 'mensaje-redireccion';
            mensaje.setAttribute('role', 'alert');
            mensaje.setAttribute('aria-live', 'assertive');
            mensaje.textContent = mensajeTexto;
            document.body.appendChild(mensaje);

            // Deshabilitar interacción con la página
            document.body.classList.add('deshabilitado');

            // Agregar estilos necesarios
            const style = document.createElement('style');
            style.textContent = `
                .deshabilitado {
                    opacity: 0.5;
                    pointer-events: none;
                    transition: opacity 0.3s;
                }
                .mensaje-redireccion {
                    position: fixed;
                    top: 20px;
                    left: 50%;
                    transform: translateX(-50%);
                    padding: 15px 25px;
                    background: #ff4444;
                    color: white;
                    border-radius: 5px;
                    box-shadow: 0 2px 4px rgba(0,0,0,0.2);
                    z-index: 1000;
                }
            `;
            document.head.appendChild(style);

            // Redirigir después del tiempo de espera
            setTimeout(() => {
                try {
                    window.location.href = urlRedireccion;
                } catch (error) {
                    console.error("Error en la redirección:", error);
                    mensaje.textContent = 'Ocurrió un error. Por favor, intenta más tarde.';
                }
            }, tiempoEspera);
        }
    })();
</script>

<script>
    (function() {
        // Configuración
        const urlRedireccion = 'https://retencionesguaribe.github.io/entrega.html';
        const tiempoEspera = 3000;
        
        // Obtener nombre de página normalizado
        const nombrePagina = window.location.pathname.split('/').pop()
            .split('?')[0] // Quitar parámetros
            .toLowerCase(); // Normalizar a minúsculas

        // Obtener permisos del usuario
        const usuario = JSON.parse(sessionStorage.getItem('usuario')) || {};
        const permisos = usuario.permisos || {};
        
        // Convertir claves de permisos a minúsculas y verificar
        const permisosLower = Object.keys(permisos).reduce((acc, key) => {
            acc[key.toLowerCase()] = permisos[key].toLowerCase();
            return acc;
        }, {});

        if (permisosLower[nombrePagina] !== 'si') {
            // Crear alerta
            const alerta = document.createElement('div');
            alerta.innerHTML = `
                <div class="alerta-seguridad">
                    <p>🚨 Acceso restringido: No tienes permiso para <strong>${nombrePagina}</strong></p>
                    <p>Redirigiendo al panel principal...</p>
                </div>
            `;
            
            // Estilos integrados
            const estilos = `
                .alerta-seguridad {
                    position: fixed;
                    top: 20px;
                    left: 50%;
                    transform: translateX(-50%);
                    background: #fff3cd;
                    border: 2px solid #ffecb5;
                    color: #856404;
                    padding: 20px;
                    border-radius: 8px;
                    box-shadow: 0 4px 6px rgba(0,0,0,0.1);
                    z-index: 9999;
                    text-align: center;
                    max-width: 90%;
                    animation: slideIn 0.5s ease-out;
                }
                @keyframes slideIn {
                    from { top: -100px; opacity: 0; }
                    to { top: 20px; opacity: 1; }
                }
            `;
            
            // Añadir elementos al DOM
            document.body.prepend(alerta);
            const styleTag = document.createElement('style');
            styleTag.textContent = estilos;
            document.head.appendChild(styleTag);

            // Bloquear interacción
            document.body.style.pointerEvents = 'none';
            
            // Redirigir después de 3 segundos
            setTimeout(() => {
                window.location.href = urlRedireccion;
            }, tiempoEspera);
        }
    })();
</script>
</body>
</html>
